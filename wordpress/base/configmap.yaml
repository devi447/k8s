<?php

/** =========================
 * Database settings
 * ========================= */
define('DB_NAME', getenv('WORDPRESS_DB_NAME'));
define('DB_USER', getenv('WORDPRESS_DB_USER'));
define('DB_PASSWORD', getenv('WORDPRESS_DB_PASSWORD'));
define('DB_HOST', getenv('WORDPRESS_DB_HOST'));
define('DB_CHARSET', 'utf8');
define('DB_COLLATE', '');

/** Table prefix (MUST NOT be empty) */
$table_prefix = 'wp_';

/** =========================
 * FORCE HTTPS (CRITICAL)
 * ========================= */
define('WP_HOME', 'https://wordpress.stg.showmysite.click');
define('WP_SITEURL', 'https://wordpress.stg.showmysite.click');

/**
 * Trust AWS ALB / reverse proxy headers
 */
if (
    (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] === 'https') ||
    (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on')
) {
    $_SERVER['HTTPS'] = 'on';
    $_SERVER['SERVER_PORT'] = 443;              // 🔴 VERY IMPORTANT
}

/**
 * Fix REST API + Block Editor behind ALB
 */
if (isset($_SERVER['HTTP_X_FORWARDED_HOST'])) {
    $_SERVER['HTTP_HOST'] = $_SERVER['HTTP_X_FORWARDED_HOST']; // 🔴 IMPORTANT
}

/** Force SSL for admin & login */
define('FORCE_SSL_ADMIN', true);
define('FORCE_SSL_LOGIN', true);

/** =========================
 * Absolute path
 * ========================= */
if ( ! defined('ABSPATH') ) {
    define('ABSPATH', '/var/www/html/');
}

/** =========================
 * Production settings
 * ========================= */
define('WP_DEBUG', false);
define('WP_DEBUG_DISPLAY', false);
define('SCRIPT_DEBUG', false);

/** Load WordPress */
require_once ABSPATH . 'wp-settings.php';
